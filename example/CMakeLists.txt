#
# Copyright (c) 2019 Kris Jusiak (kris at jusiak dot net)
#
# Distributed under the Boost Software License, Version 1.0.
# (See accompanying file LICENSE_1_0.txt or copy at http://www.boost.org/LICENSE_1_0.txt)
#
find_program(MEMORYCHECK_COMMAND valgrind)

if (ENABLE_MEMCHECK AND MEMORYCHECK_COMMAND)
  function(example file target)
    add_executable(${target} ${file}.cpp)
    add_custom_command(TARGET ${target} COMMAND ${MEMORYCHECK_COMMAND}
      --leak-check=full --error-exitcode=1 ./${target} ${ARGN})
  endfunction()
else()
  function(example file target)
    add_executable(${target} ${file}.cpp)
    add_custom_command(TARGET ${target} COMMAND ${target} ${ARGN})
  endfunction()
endif()

example(cfg/runner runner)
example(cfg/reporter reporter)
if (NOT "${CMAKE_CXX_COMPILER_ID}" STREQUAL "MSVC")
  example(abort abort)
endif()
example(BDD BDD)
example(cli cli_pass "cli.pass")
example(cli cli_pass_dry_run "cli.pass" "1")
example(cli cli_pass_not_dry_run "cli.pass" "0")
example(cli cli_all_dry_run "\\*" "1")
example(cli cli_fail_dry_run "cli.fail" "1")
example(exception exception)
example(expect expect)
example(filter filter)
example(hello_world hello_world)
example(log log)
example(macro macro)
example(minimal minimal)
example(matcher matcher)
example(parameterized parameterized)
example(run run)
example(section section)
example(skip skip)
example(suite suite)
example(using using)
